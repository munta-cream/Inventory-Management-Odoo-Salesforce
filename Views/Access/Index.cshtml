@model List<Inventory_Management_Requirements.Models.InventoryAccess>

<div class="access-container">
    <h3>Access Management</h3>
    
    <!-- Form to add new user access -->
    <form asp-controller="Inventories" asp-action="AddUserAccess" method="post" class="mb-4">
        @{
            var inventoryId = "";
            if (ViewData.ContainsKey("InventoryId") && ViewData["InventoryId"] != null)
            {
                inventoryId = ViewData["InventoryId"].ToString();
            }
        }
        <input type="hidden" name="inventoryId" value="@inventoryId" />
        <div class="form-group">
            <label for="userId">Add User Access:</label>
            <select name="userId" class="form-control" required>
                <option value="">Select a user</option>
                @{
                    if (ViewData.ContainsKey("Users") && ViewData["Users"] != null)
                    {
                        var users = ViewData["Users"] as List<Inventory_Management_Requirements.Models.ApplicationUser>;
                        if (users != null && users.Count > 0)
                        {
                            foreach (var user in users)
                            {
                                if (user != null && !string.IsNullOrEmpty(user.Id) && !string.IsNullOrEmpty(user.UserName))
                                {
                                    <option value="@user.Id">@user.UserName</option>
                                }
                            }
                        }
                        else
                        {
                            <option disabled>No users available</option>
                        }
                    }
                    else
                    {
                        <option disabled>No users available</option>
                    }
                }
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Add Access</button>
    </form>

    <table class="table">
        <thead>
            <tr>
                <th>User</th>
                <th>Can Edit</th>
                <th>Can Manage</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                foreach (var access in Model)
                {
                    <tr>
                        <td>@access.User?.UserName</td>
                        <td>@(access.CanEdit ? "Yes" : "No")</td>
                        <td>@(access.CanManage ? "Yes" : "No")</td>
                        <td>
                            <form asp-controller="Inventories" asp-action="RemoveUserAccess" method="post" style="display:inline;">
                                <input type="hidden" name="inventoryId" value="@access.InventoryId" />
                                <input type="hidden" name="userId" value="@access.UserId" />
                                <button type="submit" class="btn btn-danger">Remove Access</button>
                            </form>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="4">No users have access to this inventory.</td>
                </tr>
            }
        </tbody>
    </table>
</div>
